{
  "name": "Test Mistral Code Direct",
  "nodes": [
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "Test Manuel",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "functionCode": "// Donn√©es de test\nconst testData = {\n  title: \"Alternance Cybers√©curit√©\",\n  company: \"TechCorp\",\n  location: \"Paris\"\n};\n\nconsole.log('üìù Donn√©es de test pr√©par√©es:', testData);\n\nreturn {\n  json: testData\n};"
      },
      "id": "preparation-donnees",
      "name": "Pr√©paration Donn√©es",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "language": "javascript",
        "jsCode": "// Appel direct API Mistral avec fetch\n// √âvite tous les probl√®mes du n≈ìud HTTP Request\n\nconst fetch = require('node-fetch');\n\nasync function callMistralAPI() {\n  try {\n    console.log('üöÄ Appel direct API Mistral...');\n    \n    // ATTENTION: Remplacez par votre vraie cl√© API\n    const API_KEY = 'VOTRE_CLE_API_MISTRAL_ICI';\n    \n    if (API_KEY === 'VOTRE_CLE_API_MISTRAL_ICI') {\n      throw new Error('‚ùå Veuillez remplacer VOTRE_CLE_API_MISTRAL_ICI par votre vraie cl√© API');\n    }\n    \n    // Construction du prompt\n    const prompt = `Analyse cette offre d'emploi : Titre: ${$input.first().json.title} chez ${$input.first().json.company} √† ${$input.first().json.location}. Cette offre correspond-elle √† une alternance en cybers√©curit√© ? R√©ponds uniquement par: VALIDE ou INVALIDE`;\n    \n    // Payload Mistral\n    const payload = {\n      model: \"mistral-small-latest\",\n      messages: [\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      temperature: 0.1,\n      max_tokens: 10\n    };\n    \n    console.log('üì§ Payload:', JSON.stringify(payload, null, 2));\n    \n    // Appel API\n    const response = await fetch('https://api.mistral.ai/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${API_KEY}`\n      },\n      body: JSON.stringify(payload)\n    });\n    \n    console.log('üì• Status:', response.status);\n    console.log('üì• Headers:', Object.fromEntries(response.headers));\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`API Error ${response.status}: ${errorText}`);\n    }\n    \n    const data = await response.json();\n    console.log('‚úÖ R√©ponse re√ßue:', JSON.stringify(data, null, 2));\n    \n    if (data.choices && data.choices[0] && data.choices[0].message) {\n      const content = data.choices[0].message.content;\n      const isValid = content.toUpperCase().includes('VALIDE');\n      \n      console.log('üéØ R√©ponse Mistral:', content);\n      console.log('üîç Classification:', isValid ? 'VALIDE' : 'INVALIDE');\n      \n      return {\n        success: true,\n        mistral_response: content,\n        classification: isValid ? 'VALIDE' : 'INVALIDE',\n        is_valid: isValid,\n        method: 'direct_fetch',\n        usage: data.usage\n      };\n    } else {\n      throw new Error('Structure de r√©ponse inattendue');\n    }\n    \n  } catch (error) {\n    console.log('‚ùå Erreur:', error.message);\n    return {\n      success: false,\n      error: error.message,\n      method: 'direct_fetch'\n    };\n  }\n}\n\n// Ex√©cution\nreturn await callMistralAPI();"
      },
      "id": "appel-mistral-direct",
      "name": "Appel Mistral Direct",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "functionCode": "// Affichage des r√©sultats finaux\nconsole.log('üìä === R√âSULTATS FINAUX ===');\nconsole.log('Succ√®s:', $json.success);\n\nif ($json.success) {\n  console.log('‚úÖ Test r√©ussi!');\n  console.log('R√©ponse Mistral:', $json.mistral_response);\n  console.log('Classification:', $json.classification);\n  console.log('Valide:', $json.is_valid);\n  console.log('Usage:', $json.usage);\n} else {\n  console.log('‚ùå Test √©chou√©!');\n  console.log('Erreur:', $json.error);\n}\n\nreturn { json: $json };"
      },
      "id": "affichage-resultats",
      "name": "Affichage R√©sultats",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 300]
    }
  ],
  "connections": {
    "Test Manuel": {
      "main": [
        [
          {
            "node": "Pr√©paration Donn√©es",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pr√©paration Donn√©es": {
      "main": [
        [
          {
            "node": "Appel Mistral Direct",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Appel Mistral Direct": {
      "main": [
        [
          {
            "node": "Affichage R√©sultats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "id": "test-mistral-code-direct",
      "name": "Code Direct"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-06-03T23:30:00.000Z",
  "versionId": "3.0.0"
}