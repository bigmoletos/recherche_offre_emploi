{
  "name": "Test Mistral Docker - BodyParams",
  "nodes": [
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "Test Manuel",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Pr√©paration payload pour bodyParameters Docker\n// √âvite les probl√®mes d'expression {{ $json }}\n\nconst payload = {\n  model: \"mistral-small-latest\",\n  messages: JSON.stringify([\n    {\n      role: \"user\",\n      content: \"Test Docker: Cette offre 'Alternance Cybers√©curit√©' est-elle valide ? R√©ponds VALIDE ou INVALIDE.\"\n    }\n  ]),\n  temperature: \"0.1\",\n  max_tokens: \"15\"\n};\n\nconsole.log('üê≥ === DOCKER BODYPARAMS SOLUTION ===');\nconsole.log('‚úÖ Model:', payload.model);\nconsole.log('‚úÖ Messages (JSON string):', payload.messages);\nconsole.log('‚úÖ Temperature:', payload.temperature);\nconsole.log('‚úÖ Max tokens:', payload.max_tokens);\nconsole.log('üîë Auth: Header avec cl√© valid√©e');\n\n// Retour pour bodyParameters\nreturn { json: payload };"
      },
      "id": "preparation",
      "name": "Pr√©paration BodyParams",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.mistral.ai/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer fe8GdBIIBwYk8Dj1GvclASPE3j0Zbt95"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "={{ $json.model }}"
            },
            {
              "name": "messages",
              "value": "={{ $json.messages }}"
            },
            {
              "name": "temperature",
              "value": "={{ $json.temperature }}"
            },
            {
              "name": "max_tokens",
              "value": "={{ $json.max_tokens }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          },
          "timeout": 30000
        }
      },
      "id": "api-call",
      "name": "API Call BodyParams",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [680, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForAllItems",
        "jsCode": "// Debug r√©ponse BodyParams Docker\nconsole.log('üéØ === R√âPONSE BODYPARAMS DOCKER ===');\nconsole.log('üìä Type:', typeof $input.first().json);\nconsole.log('üîç Keys:', Object.keys($input.first().json || {}));\nconsole.log('üìã Full response:');\nconsole.log(JSON.stringify($input.first().json, null, 2));\n\nconst data = $input.first().json;\n\n// V√©rification structure Mistral\nif (data && data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content) {\n  const content = data.choices[0].message.content.trim();\n  \n  console.log('‚úÖ === BODYPARAMS SUCCESS ! ===');\n  console.log('üìù Mistral response:', content);\n  \n  // Classification\n  const contentUpper = content.toUpperCase();\n  const isValid = contentUpper.includes('VALIDE') && !contentUpper.includes('INVALIDE');\n  const classification = isValid ? 'VALIDE' : 'INVALIDE';\n  \n  console.log('üîç Classification:', classification);\n  console.log('‚ö° Model:', data.model);\n  console.log('üìä Usage:', JSON.stringify(data.usage || {}));\n  \n  return {\n    json: {\n      success: true,\n      mistral_response: content,\n      classification: classification,\n      is_valid: isValid,\n      method: 'docker_bodyparams',\n      model_used: data.model,\n      usage: data.usage,\n      test_status: 'BODYPARAMS_SUCCESS',\n      recommendation: 'BodyParams fonctionne avec Docker N8N'\n    }\n  };\n} \n\n// Erreur API\nelse if (data && data.error) {\n  console.log('üö® Erreur API BodyParams:', data.error);\n  return {\n    json: {\n      success: false,\n      error: data.error,\n      method: 'docker_bodyparams',\n      test_status: 'API_ERROR'\n    }\n  };\n}\n\n// Structure inattendue  \nelse {\n  console.log('‚ùå Structure BodyParams invalide');\n  return {\n    json: {\n      success: false,\n      error: 'Structure r√©ponse invalide',\n      received_data: data,\n      method: 'docker_bodyparams',\n      test_status: 'BODYPARAMS_FAILED'\n    }\n  };\n}"
      },
      "id": "debug-response",
      "name": "Debug BodyParams",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    }
  ],
  "connections": {
    "Test Manuel": {
      "main": [
        [
          {
            "node": "Pr√©paration BodyParams",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pr√©paration BodyParams": {
      "main": [
        [
          {
            "node": "API Call BodyParams",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API Call BodyParams": {
      "main": [
        [
          {
            "node": "Debug BodyParams",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "id": "docker-bodyparams",
      "name": "Docker BodyParams"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-06-05T09:15:00.000Z",
  "versionId": "9.0.0"
}