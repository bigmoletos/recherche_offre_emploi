{
  "name": "La Bonne Alternance - API Cybers√©curit√©",
  "nodes": [
    {
      "parameters": {},
      "id": "start-lba",
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "jsCode": "// CONFIGURATION LA BONNE ALTERNANCE - CYBERS√âCURIT√â\nconsole.log('üîç === CONFIGURATION LA BONNE ALTERNANCE ===');\n\n// Codes ROME pour cybers√©curit√©/informatique\nconst codesRomeCyber = [\n  'M1802', // Expertise et support en syst√®mes d'information\n  'M1810', // Production et exploitation de syst√®mes d'information\n  'M1806', // Conseil et ma√Ætrise d'ouvrage en syst√®mes d'information\n  'M1805'  // √âtudes et d√©veloppement informatique\n];\n\n// Mots-cl√©s sp√©cifiques cybers√©curit√©\nconst motsClesCyber = [\n  'cybers√©curit√©',\n  'cybersecurity', \n  's√©curit√© informatique',\n  'SOC',\n  'SIEM',\n  'pentest',\n  'analyste s√©curit√©',\n  'cyber analyst',\n  'incident response'\n];\n\n// Localisation France (principales villes)\nconst localisations = [\n  { nom: 'Paris', lat: 48.8566, lon: 2.3522, radius: 50 },\n  { nom: 'Lyon', lat: 45.7640, lon: 4.8357, radius: 30 },\n  { nom: 'Marseille', lat: 43.2965, lon: 5.3698, radius: 30 },\n  { nom: 'Toulouse', lat: 43.6047, lon: 1.4442, radius: 30 },\n  { nom: 'Nantes', lat: 47.2184, lon: -1.5536, radius: 30 },\n  { nom: 'France enti√®re', lat: 46.6034, lon: 1.8883, radius: 200 }\n];\n\nconsole.log('üéØ Codes ROME cybers√©curit√©:', codesRomeCyber.join(', '));\nconsole.log('üîë Mots-cl√©s configur√©s:', motsClesCyber.length);\nconsole.log('üìç Zones g√©ographiques:', localisations.length);\n\n// G√©n√©ration des requ√™tes de recherche\nconst requetesRecherche = [];\n\n// Combiner mots-cl√©s avec localisations\nmotsClesCyber.slice(0, 3).forEach(motCle => { // Limiter √† 3 mots-cl√©s principaux\n  localisations.slice(0, 3).forEach(zone => { // Limiter √† 3 zones principales\n    requetesRecherche.push({\n      recherche_id: `lba-${motCle.toLowerCase().replace(/\\s+/g, '-')}-${zone.nom.toLowerCase().replace(/\\s+/g, '-')}-${Date.now()}`,\n      mot_cle: motCle,\n      zone_geo: zone,\n      codes_rome: codesRomeCyber.join(','),\n      api_params: {\n        latitude: zone.lat,\n        longitude: zone.lon,\n        radius: zone.radius,\n        romes: codesRomeCyber.join(','),\n        caller: 'n8n-cybersecurity-search',\n        diploma: 'Cap,Bac,BTS,Licence,Master' // Tous niveaux\n      },\n      timestamp: new Date().toISOString()\n    });\n  });\n});\n\nconsole.log('üìã Requ√™tes g√©n√©r√©es:', requetesRecherche.length);\nrequetesRecherche.forEach((req, index) => {\n  console.log(`${index + 1}. ${req.mot_cle} dans ${req.zone_geo.nom}`);\n});\n\nreturn requetesRecherche.map(req => ({ json: req }));"
      },
      "id": "config-lba-search",
      "name": "üîç Config Recherche LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://labonnealternance.pole-emploi.fr/api/v1/jobs/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "latitude",
              "value": "={{ $json.api_params.latitude }}"
            },
            {
              "name": "longitude",
              "value": "={{ $json.api_params.longitude }}"
            },
            {
              "name": "radius",
              "value": "={{ $json.api_params.radius }}"
            },
            {
              "name": "romes",
              "value": "={{ $json.api_params.romes }}"
            },
            {
              "name": "caller",
              "value": "{{ $json.api_params.caller }}"
            },
            {
              "name": "diploma",
              "value": "{{ $json.api_params.diploma }}"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "call-lba-api",
      "name": "üåê Appel API LBA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// TRAITEMENT R√âPONSE API LA BONNE ALTERNANCE\nconst rechercheContext = $('üîç Config Recherche LBA').item.json;\nconst apiResponse = $input.item.json;\n\nconsole.log(`üìä === TRAITEMENT LBA: ${rechercheContext.mot_cle} ===`);\nconsole.log('üìç Zone:', rechercheContext.zone_geo.nom);\nconsole.log('üîç Recherche ID:', rechercheContext.recherche_id);\n\n// V√©rifier la structure de la r√©ponse\nif (!apiResponse || !apiResponse.jobs) {\n  console.log('‚ö†Ô∏è R√©ponse API LBA invalide ou vide');\n  console.log('üìã R√©ponse re√ßue:', JSON.stringify(apiResponse, null, 2));\n  \n  return {\n    json: {\n      ...rechercheContext,\n      api_result: {\n        success: false,\n        error: 'Structure r√©ponse invalide',\n        raw_response: apiResponse,\n        offers_count: 0,\n        offers: []\n      },\n      processing_status: 'API_ERROR'\n    }\n  };\n}\n\nconst jobs = apiResponse.jobs || [];\nconsole.log('üìã Offres re√ßues de LBA:', jobs.length);\n\nif (jobs.length === 0) {\n  console.log('‚ö†Ô∏è Aucune offre trouv√©e pour cette recherche');\n  return {\n    json: {\n      ...rechercheContext,\n      api_result: {\n        success: true,\n        offers_count: 0,\n        offers: [],\n        search_exhausted: true\n      },\n      processing_status: 'NO_RESULTS'\n    }\n  };\n}\n\n// Traitement et enrichissement des offres\nconst offresEnrichies = jobs.map((job, index) => {\n  // Normalisation des donn√©es LBA\n  const offreNormalisee = {\n    // Identifiants\n    offer_id: job.id || `lba-${rechercheContext.recherche_id}-${index}`,\n    external_id: job.id,\n    source: 'La Bonne Alternance',\n    source_type: 'api_officielle',\n    \n    // Donn√©es principales\n    title: job.title || job.intitule || 'Titre non sp√©cifi√©',\n    company: job.company?.name || job.entreprise?.raison_sociale || 'Entreprise non sp√©cifi√©e',\n    description: job.description || job.job?.description || '',\n    \n    // Contrat (LBA = 100% alternance)\n    contract_type: job.contractType || 'Alternance',\n    contract_duration: job.duration || job.duree || '',\n    \n    // Localisation\n    location: `${job.place?.city || job.lieu?.ville || ''} (${job.place?.zipCode || job.lieu?.codePostal || ''})`,\n    address: job.place?.address || job.lieu?.adresse || '',\n    coordinates: {\n      lat: job.place?.latitude || job.lieu?.latitude,\n      lon: job.place?.longitude || job.lieu?.longitude\n    },\n    \n    // D√©tails offre\n    salary: job.salary || job.salaire || 'Non sp√©cifi√©',\n    start_date: job.startDate || job.dateDebut || '',\n    application_url: job.url || job.contact?.url || '',\n    \n    // Contact entreprise\n    contact_info: {\n      email: job.contact?.email || '',\n      phone: job.contact?.phone || job.contact?.telephone || '',\n      website: job.company?.url || job.entreprise?.url || ''\n    },\n    \n    // M√©tadonn√©es de recherche\n    search_context: {\n      keyword: rechercheContext.mot_cle,\n      location_searched: rechercheContext.zone_geo.nom,\n      rome_codes: rechercheContext.codes_rome,\n      search_id: rechercheContext.recherche_id\n    },\n    \n    // Timestamp\n    scraped_at: new Date().toISOString(),\n    posted_date: job.createdAt || job.dateCreation || '',\n    \n    // Analyse pr√©liminaire pour cybers√©curit√©\n    preliminary_analysis: {\n      contains_cyber_keywords: [\n        'cyber', 's√©curit√©', 'security', 'soc', 'siem', 'pentest'\n      ].some(kw => \n        (job.title || '').toLowerCase().includes(kw) ||\
  \n        (job.description || '').toLowerCase().includes(kw)\n      ),\n      is_alternance_contract: true, // LBA = 100% alternance\n      location_match: rechercheContext.zone_geo.nom,\n      confidence_score: 0.8 // Base pour LBA car source fiable\n    }\n  };\n  \n  // Classification pr√©liminaire\n  const isCyberSecurity = offreNormalisee.preliminary_analysis.contains_cyber_keywords;\n  const isAlternance = offreNormalisee.preliminary_analysis.is_alternance_contract;\n  \n  offreNormalisee.expected_mistral_classification = (isCyberSecurity && isAlternance) ? 'VALIDE' : 'INVALIDE';\n  \n  console.log(`üìÑ ${index + 1}. ${offreNormalisee.title} ‚Üí ${offreNormalisee.expected_mistral_classification}`);\n  \n  return offreNormalisee;\n});\n\nconsole.log('‚úÖ Enrichissement termin√©:', offresEnrichies.length, 'offres');\nconst offresValides = offresEnrichies.filter(o => o.expected_mistral_classification === 'VALIDE');\nconsole.log('üéØ Offres potentiellement valides:', offresValides.length);\n\nreturn {\n  json: {\n    ...rechercheContext,\n    api_result: {\n      success: true,\n      offers_count: offresEnrichies.length,\n      offers_cyber_potential: offresValides.length,\n      offers: offresEnrichies,\n      source_api: 'La Bonne Alternance',\n      processed_at: new Date().toISOString()\n    },\n    processing_status: 'SUCCESS'\n  }\n};"
      },
      "id": "process-lba-response",
      "name": "üìä Traiter R√©ponse LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 200]
    },
    {
      "parameters": {
        "jsCode": "// TRAITEMENT ERREUR API LA BONNE ALTERNANCE\nconst rechercheContext = $('üîç Config Recherche LBA').item.json;\nconst errorData = $input.item;\n\nconsole.log(`‚ùå === ERREUR API LBA: ${rechercheContext.mot_cle} ===`);\nconsole.log('üìç Zone recherch√©e:', rechercheContext.zone_geo.nom);\nconsole.log('üîç Code erreur:', errorData.httpCode);\nconsole.log('üìã Message:', errorData.message);\n\n// Analyse du type d'erreur LBA\nlet errorAnalysis = {\n  type: 'UNKNOWN_ERROR',\n  severity: 'HIGH',\n  suggestion: 'R√©essayer plus tard',\n  is_retryable: false\n};\n\nswitch(errorData.httpCode) {\n  case 400:\n    errorAnalysis = {\n      type: 'BAD_REQUEST',\n      severity: 'MEDIUM',\n      suggestion: 'V√©rifier les param√®tres de recherche (coordonn√©es, codes ROME)',\n      is_retryable: false\n    };\n    break;\n  case 404:\n    errorAnalysis = {\n      type: 'ENDPOINT_NOT_FOUND',\n      severity: 'HIGH',\n      suggestion: 'API endpoint modifi√©, v√©rifier la documentation LBA',\n      is_retryable: false\n    };\n    break;\n  case 429:\n    errorAnalysis = {\n      type: 'RATE_LIMIT',\n      severity: 'LOW',\n      suggestion: 'Attendre avant de r√©essayer (rate limiting)',\n      is_retryable: true\n    };\n    break;\n  case 500:\n  case 502:\n  case 503:\n    errorAnalysis = {\n      type: 'SERVER_ERROR',\n      severity: 'MEDIUM',\n      suggestion: 'Probl√®me serveur LBA, r√©essayer dans quelques minutes',\n      is_retryable: true\n    };\n    break;\n  default:\n    if (!errorData.httpCode) {\n      errorAnalysis = {\n        type: 'NETWORK_ERROR',\n        severity: 'MEDIUM',\n        suggestion: 'Probl√®me r√©seau ou timeout',\n        is_retryable: true\n      };\n    }\n}\n\nconsole.log('üè∑Ô∏è Type erreur:', errorAnalysis.type);\nconsole.log('‚ö†Ô∏è S√©v√©rit√©:', errorAnalysis.severity);\nconsole.log('üí° Suggestion:', errorAnalysis.suggestion);\nconsole.log('üîÑ Peut r√©essayer:', errorAnalysis.is_retryable);\n\nreturn {\n  json: {\n    ...rechercheContext,\n    api_result: {\n      success: false,\n      offers_count: 0,\n      offers: [],\n      error_details: {\n        http_code: errorData.httpCode,\n        message: errorData.message,\n        analysis: errorAnalysis,\n        raw_error: errorData,\n        timestamp: new Date().toISOString()\n      }\n    },\n    processing_status: 'API_ERROR'\n  }\n};"
      },
      "id": "process-lba-error",
      "name": "‚ùå Traiter Erreur LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 400]
    },
    {
      "parameters": {
        "jsCode": "// EXTRACTION INDIVIDUELLE DES OFFRES LBA\nconst lbaResult = $input.item.json;\n\nconsole.log(`üìÑ === EXTRACTION OFFRES LBA ===`);\nconsole.log('üîç Recherche:', lbaResult.mot_cle, 'dans', lbaResult.zone_geo.nom);\nconsole.log('üìä Statut traitement:', lbaResult.processing_status);\n\nif (lbaResult.processing_status !== 'SUCCESS' || !lbaResult.api_result.success) {\n  console.log('‚ö†Ô∏è Pas de donn√©es valides √† extraire');\n  return [];\n}\n\nconst offers = lbaResult.api_result.offers || [];\nconsole.log('üìã Offres √† extraire:', offers.length);\n\nif (offers.length === 0) {\n  console.log('‚ö†Ô∏è Aucune offre √† extraire');\n  return [];\n}\n\n// Extraction individuelle de chaque offre\nconst extractedOffers = offers.map((offer, index) => {\n  console.log(`üìÑ Extraction ${index + 1}/${offers.length}: ${offer.title}`);\n  \n  return {\n    ...offer,\n    \n    // Contexte d'extraction\n    extraction_context: {\n      source_search: lbaResult.recherche_id,\n      extraction_index: index,\n      total_offers_in_batch: offers.length,\n      extracted_at: new Date().toISOString()\n    },\n    \n    // Statut pour √©tape suivante\n    ready_for_mistral: true,\n    processing_stage: 'EXTRACTED_FROM_LBA'\n  };\n});\n\nconsole.log('‚úÖ Extraction termin√©e:', extractedOffers.length, 'offres individuelles');\n\nreturn extractedOffers.map(offer => ({ json: offer }));"
      },
      "id": "extract-lba-offers",
      "name": "üìÑ Extraire Offres LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "jsCode": "// PR√âPARATION CLASSIFICATION MISTRAL POUR OFFRES LBA\nconst offer = $input.item.json;\n\nconsole.log(`ü§ñ === PR√âPARATION MISTRAL LBA: ${offer.title} ===`);\nconsole.log('üè¢ Entreprise:', offer.company);\nconsole.log('üìç Lieu:', offer.location);\nconsole.log('üíº Type contrat:', offer.contract_type);\nconsole.log('üéØ Classification attendue:', offer.expected_mistral_classification);\nconsole.log('üìä Confiance pr√©liminaire:', offer.preliminary_analysis.confidence_score);\n\n// Prompt sp√©cialis√© pour offres La Bonne Alternance\nconst lbaClassificationPrompt = `CLASSIFICATION OFFRE ALTERNANCE CYBERS√âCURIT√â - LA BONNE ALTERNANCE :\n\n=== INFORMATIONS OFFRE ===\nTITRE: ${offer.title}\nENTREPRISE: ${offer.company}\nTYPE CONTRAT: ${offer.contract_type}\nLIEU: ${offer.location}\nDESCRIPTION: ${offer.description || 'Description non fournie'}\nSALAIRE: ${offer.salary}\nCONTACT: ${offer.contact_info.email || 'Non sp√©cifi√©'}\n\n=== CONTEXTE IMPORTANT ===\nSOURCE: La Bonne Alternance (plateforme 100% alternance officielle)\nTYPE: Toutes les offres sont des contrats d'alternance/apprentissage\nFIABILIT√â: Source gouvernementale fiable\n\n=== CRIT√àRES VALIDATION CYBERS√âCURIT√â ===\n‚úÖ VALIDE si le poste concerne :\n- Cybers√©curit√©, s√©curit√© informatique\n- SOC (Security Operations Center)\n- Analyse de s√©curit√©, incident response\n- Pentest, audit s√©curit√©\n- Administration s√©curit√© (SIEM, firewalls)\n- D√©veloppement outils cybers√©curit√©\n\n‚ùå INVALIDE si le poste concerne :\n- D√©veloppement web/mobile classique\n- Support informatique g√©n√©ral\n- R√©seaux/syst√®me sans aspect s√©curit√©\n- Marketing, commercial, RH\n- Autres domaines non-cyber\n\n=== ANALYSE REQUISE ===\nAnalyse le titre et la description pour d√©terminer si c'est un poste en cybers√©curit√©.\nCOMPTE TENU que la source (LBA) garantit que c'est de l'alternance.\n\n=== R√âPONSE ATTENDUE ===\nCLASSIFICATION: VALIDE ou INVALIDE\nJUSTIFICATION: [Explication courte pourquoi c'est cybers√©curit√© ou pas]\nCONFIANCE: [0.1 √† 1.0]`;\n\nconst mistralPayload = {\n  model: \"mistral-large-latest\",\n  messages: [\n    {\n      role: \"system\",\n      content: \"Tu es un expert en classification d'offres d'alternance cybers√©curit√©. Tu analyses sp√©cifiquement si une offre d'alternance (d√©j√† confirm√©e) concerne le domaine de la cybers√©curit√©. Source: La Bonne Alternance (officielle).\"\n    },\n    {\n      role: \"user\",\n      content: lbaClassificationPrompt\n    }\n  ],\n  temperature: 0.05,\n  max_tokens: 150\n};\n\nconsole.log('üìã Payload Mistral cr√©√© pour LBA');\nconsole.log('üîß Temp√©rature ultra-pr√©cise:', mistralPayload.temperature);\n\nreturn {\n  json: {\n    ...offer,\n    mistral_payload_string: JSON.stringify(mistralPayload),\n    classification_prompt: lbaClassificationPrompt,\n    mistral_config: {\n      model: mistralPayload.model,\n      temperature: mistralPayload.temperature,\n      max_tokens: mistralPayload.max_tokens,\n      optimized_for: 'lba_cybersecurity_classification'\n    },\n    prepared_for_mistral_at: new Date().toISOString(),\n    processing_stage: 'READY_FOR_MISTRAL_LBA'\n  }\n};"
      },
      "id": "prepare-mistral-lba",
      "name": "ü§ñ Pr√©parer Mistral LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.mistral.ai/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer fe8GdBIIBwYk8Dj1GvclASPE3j0Zbt95"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "raw",
        "body": "={{ $json.mistral_payload_string }}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "mistral-classify-lba",
      "name": "üåê Mistral Classer LBA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1560, 300],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// TRAITEMENT FINAL CLASSIFICATION LBA + MISTRAL\nconst originalOffer = $('ü§ñ Pr√©parer Mistral LBA').item.json;\nconst mistralResponse = $input.item.json;\n\nconsole.log(`‚úÖ === R√âSULTAT FINAL LBA: ${originalOffer.title} ===`);\nconsole.log('üè¢ Entreprise:', originalOffer.company);\nconsole.log('üìç Localisation:', originalOffer.location);\nconsole.log('üéØ Attendu:', originalOffer.expected_mistral_classification);\n\nif (!mistralResponse.choices || !mistralResponse.choices[0] || !mistralResponse.choices[0].message) {\n  console.log('‚ùå R√©ponse Mistral invalide');\n  return {\n    json: {\n      // Donn√©es essentielles\n      offer_id: originalOffer.offer_id,\n      title: originalOffer.title,\n      company: originalOffer.company,\n      location: originalOffer.location,\n      source: 'La Bonne Alternance',\n      \n      // R√©sultat classification\n      final_classification: 'ERREUR_MISTRAL',\n      mistral_justification: 'R√©ponse API malform√©e',\n      is_valid_cybersecurity_alternance: false,\n      confidence_score: 0,\n      processing_status: 'ERROR'\n    }\n  };\n}\n\nconst mistralContent = mistralResponse.choices[0].message.content.trim();\nconsole.log('üìù R√©ponse Mistral compl√®te:', mistralContent);\n\n// Extraction classification avec patterns robustes\nlet classification = 'INCERTAIN';\nlet justification = 'Non trouv√©e';\nlet confidence = 0.5;\n\n// Pattern CLASSIFICATION\nconst classificationMatch = mistralContent.match(/CLASSIFICATION:\\s*(VALIDE|INVALIDE)/i);\nif (classificationMatch) {\n  classification = classificationMatch[1].toUpperCase();\n}\n\n// Pattern JUSTIFICATION  \nconst justificationMatch = mistralContent.match(/JUSTIFICATION:\\s*([^\\n]+)/i);\nif (justificationMatch) {\n  justification = justificationMatch[1].trim();\n}\n\n// Pattern CONFIANCE\nconst confidenceMatch = mistralContent.match(/CONFIANCE:\\s*([0-9.]+)/i);\nif (confidenceMatch) {\n  confidence = parseFloat(confidenceMatch[1]);\n}\n\n// Validation de la pr√©diction\nconst isCorrectPrediction = classification === originalOffer.expected_mistral_classification;\nconst finalConfidence = classificationMatch ? Math.max(confidence, 0.8) : 0.3;\n\nconsole.log('üéØ Classification Mistral:', classification);\nconsole.log('üìã Justification:', justification);\nconsole.log('üìä Confiance:', finalConfidence);\nconsole.log('‚úÖ Pr√©diction correcte:', isCorrectPrediction);\n\n// R√©sultat final optimis√© pour LBA\nconst finalResult = {\n  // Identifiants\n  offer_id: originalOffer.offer_id,\n  external_id: originalOffer.external_id,\n  source: 'La Bonne Alternance',\n  source_type: 'api_officielle',\n  \n  // Donn√©es offre principales\n  title: originalOffer.title,\n  company: originalOffer.company,\n  description: originalOffer.description,\n  location: originalOffer.location,\n  contract_type: originalOffer.contract_type,\n  salary: originalOffer.salary,\n  application_url: originalOffer.application_url,\n  \n  // Contact\n  contact_email: originalOffer.contact_info.email,\n  contact_phone: originalOffer.contact_info.phone,\n  \n  // R√©sultat classification final\n  final_classification: classification,\n  mistral_justification: justification,\n  confidence_score: finalConfidence,\n  is_valid_cybersecurity_alternance: classification === 'VALIDE',\n  \n  // Contexte de recherche\n  search_keyword: originalOffer.search_context.keyword,\n  search_location: originalOffer.search_context.location_searched,\
  \n  // Validation pr√©diction\n  expected_classification: originalOffer.expected_mistral_classification,\n  is_prediction_correct: isCorrectPrediction,\n  \n  // M√©tadonn√©es techniques\n  mistral_model: mistralResponse.model,\n  tokens_used: mistralResponse.usage,\n  processed_at: new Date().toISOString(),\n  processing_status: 'COMPLETED',\n  \n  // Scores et qualit√©\n  preliminary_confidence: originalOffer.preliminary_analysis.confidence_score,\n  final_confidence: finalConfidence,\n  source_reliability: 0.95, // LBA = source tr√®s fiable\n  overall_quality_score: (finalConfidence + 0.95) / 2 // Moyenne confiance + fiabilit√© source\n};\n\nif (classification === 'VALIDE') {\n  console.log('üéâ OFFRE CYBERS√âCURIT√â ALTERNANCE RETENUE:', originalOffer.title);\n  console.log('üè¢ Entreprise:', originalOffer.company);\n  console.log('üìß Contact:', originalOffer.contact_info.email);\n} else {\n  console.log('‚ùå OFFRE NON-CYBERS√âCURIT√â:', originalOffer.title);\n  console.log('üí≠ Raison:', justification);\n}\n\nreturn { json: finalResult };"
      },
      "id": "final-result-lba",
      "name": "üéØ R√©sultat Final LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1780, 200]
    },
    {
      "parameters": {
        "jsCode": "// GESTION ERREUR MISTRAL POUR LBA\nconst originalOffer = $('ü§ñ Pr√©parer Mistral LBA').item.json;\nconst errorData = $input.item;\n\nconsole.log(`‚ùå === ERREUR MISTRAL LBA: ${originalOffer.title} ===`);\nconsole.log('üìç Source: La Bonne Alternance');\nconsole.log('üîç Code erreur:', errorData.httpCode);\n\nreturn {\n  json: {\n    offer_id: originalOffer.offer_id,\n    title: originalOffer.title,\n    company: originalOffer.company,\n    source: 'La Bonne Alternance',\n    final_classification: 'ERREUR_MISTRAL',\n    is_valid_cybersecurity_alternance: false,\n    confidence_score: 0,\n    error_details: {\n      error_type: 'MISTRAL_API_ERROR',\n      error_code: errorData.httpCode,\n      error_message: errorData.message\n    },\n    processing_status: 'ERROR'\n  }\n};"
      },
      "id": "error-mistral-lba",
      "name": "‚ùå Erreur Mistral LBA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1780, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-lba-valid",
              "leftValue": "={{ $json.is_valid_cybersecurity_alternance }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter-lba-cyber",
      "name": "üîç Filtrer Cyber Alternance",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [2000, 300]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "lba-action",
              "name": "action",
              "value": "ALTERNANCE_CYBERSECURITE_TROUVEE",
              "type": "string"
            },
            {
              "id": "lba-titre",
              "name": "titre",
              "value": "{{ $json.title }}",
              "type": "string"
            },
            {
              "id": "lba-entreprise",
              "name": "entreprise",
              "value": "{{ $json.company }}",
              "type": "string"
            },
            {
              "id": "lba-lieu",
              "name": "localisation",
              "value": "{{ $json.location }}",
              "type": "string"
            },
            {
              "id": "lba-salaire",
              "name": "remuneration",
              "value": "{{ $json.salary }}",
              "type": "string"
            },
            {
              "id": "lba-contact",
              "name": "contact",
              "value": "{{ $json.contact_email }}",
              "type": "string"
            },
            {
              "id": "lba-url",
              "name": "lien_candidature",
              "value": "{{ $json.application_url }}",
              "type": "string"
            },
            {
              "id": "lba-justification",
              "name": "pourquoi_valide",
              "value": "{{ $json.mistral_justification }}",
              "type": "string"
            },
            {
              "id": "lba-confiance",
              "name": "score_confiance",
              "value": "{{ $json.confidence_score }}",
              "type": "number"
            },
            {
              "id": "lba-resume",
              "name": "resume",
              "value": "‚úÖ {{ $json.title }} chez {{ $json.company }} - Alternance Cybers√©curit√© - {{ $json.location }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "format-cyber-alternance",
      "name": "‚úÖ Cyber Alternance Trouv√©e",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [2220, 200]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "lba-rejected-action",
              "name": "action",
              "value": "OFFRE_NON_CYBERSECURITE",
              "type": "string"
            },
            {
              "id": "lba-rejected-titre",
              "name": "titre",
              "value": "{{ $json.title }}",
              "type": "string"
            },
            {
              "id": "lba-rejected-entreprise",
              "name": "entreprise",
              "value": "{{ $json.company }}",
              "type": "string"
            },
            {
              "id": "lba-rejected-raison",
              "name": "raison_rejet",
              "value": "{{ $json.final_classification }} - {{ $json.mistral_justification }}",
              "type": "string"
            },
            {
              "id": "lba-rejected-resume",
              "name": "resume",
              "value": "‚ùå {{ $json.title }} - Alternance mais pas cybers√©curit√©",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "format-non-cyber",
      "name": "‚ùå Non Cybers√©curit√©",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [2220, 400]
    }
  ],
  "pinData": {},
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "üîç Config Recherche LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîç Config Recherche LBA": {
      "main": [
        [
          {
            "node": "üåê Appel API LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üåê Appel API LBA": {
      "main": [
        [
          {
            "node": "üìä Traiter R√©ponse LBA",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "‚ùå Traiter Erreur LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìä Traiter R√©ponse LBA": {
      "main": [
        [
          {
            "node": "üìÑ Extraire Offres LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùå Traiter Erreur LBA": {
      "main": [
        [
          {
            "node": "üìÑ Extraire Offres LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìÑ Extraire Offres LBA": {
      "main": [
        [
          {
            "node": "ü§ñ Pr√©parer Mistral LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ü§ñ Pr√©parer Mistral LBA": {
      "main": [
        [
          {
            "node": "üåê Mistral Classer LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üåê Mistral Classer LBA": {
      "main": [
        [
          {
            "node": "üéØ R√©sultat Final LBA",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "‚ùå Erreur Mistral LBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üéØ R√©sultat Final LBA": {
      "main": [
        [
          {
            "node": "üîç Filtrer Cyber Alternance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ùå Erreur Mistral LBA": {
      "main": [
        [
          {
            "node": "üîç Filtrer Cyber Alternance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üîç Filtrer Cyber Alternance": {
      "main": [
        [
          {
            "node": "‚úÖ Cyber Alternance Trouv√©e",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚ùå Non Cybers√©curit√©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "v1",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "workflow-lba",
  "tags": ["lba", "alternance"]
}